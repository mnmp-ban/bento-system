<!-- ç¤¾å†…ãŠå¼å½“æ³¨æ–‡ã‚·ã‚¹ãƒ†ãƒ  æ‹¡å¼µãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆãƒ©ãƒ³ãƒãƒ‡ãƒ¼å¯¾å¿œãƒ»å‡ºç¤¾è€…ä¸€æ‹¬å…¥åŠ›ãƒ»ä¾¡æ ¼åˆ‡æ›¿ãƒ»CSVåç°¿å¯¾å¿œï¼‰ -->
<!-- æ³¨æ–‡ç”»é¢ãƒ»å±¥æ­´ç”»é¢ã®ä¾¡æ ¼è¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯åæ˜  -->

<!-- ...ï¼ˆç®¡ç†è€…ç”»é¢ãªã©æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã¯çœç•¥ï¼‰ ... -->

<script>
// ...ï¼ˆæ—¢å­˜ã® lunchDays ã‚„ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ãƒ»ä¾¡æ ¼é–¢æ•°ãªã©ã®ã‚³ãƒ¼ãƒ‰ï¼‰ ...

function loadOrderForm() {
  const today = new Date();
  const orderContent = document.getElementById('orderContent');
  let html = '';

  for (let i = 0; i < 7; i++) {
    const date = new Date(today);
    date.setDate(today.getDate() + i);
    const dateStr = date.toISOString().split('T')[0];
    const dayNames = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
    const dayName = dayNames[date.getDay()];

    if (menus[dateStr]) {
      const canOrderNormal = canOrderNormalBento(date);
      const canOrderNoodleMenu = canOrderNoodle(date);
      const currentOrder = getUserOrder(dateStr);

      html += `
        <div class="menu-card">
          <div class="menu-date">
            ${date.getMonth() + 1}æœˆ${date.getDate()}æ—¥ï¼ˆ${dayName}ï¼‰
            ${getOrderStatusBadge(date)}
            ${isLunchDay(dateStr) ? '<span class="status-badge status-active">ğŸ±è£œåŠ©å¯¾è±¡</span>' : ''}
          </div>
          ${getDeadlineInfo(date)}
          <div class="menu-options">
            <div class="menu-option ${currentOrder === 'none' ? 'selected' : ''}" onclick="selectOption('${dateStr}', 'none')">
              <div class="option-name">æ³¨æ–‡ã—ãªã„</div>
              <div class="option-price">0å††</div>
            </div>
            <div class="menu-option ${currentOrder === 'normal' ? 'selected' : ''}" onclick="selectOption('${dateStr}', 'normal')" ${!canOrderNormal ? 'style="opacity:0.5;cursor:not-allowed;"' : ''}>
              <div class="option-name">${menus[dateStr].normal}</div>
              <div class="option-price">${getPriceDisplay('normal', dateStr)}</div>
            </div>
            <div class="menu-option ${currentOrder === 'large' ? 'selected' : ''}" onclick="selectOption('${dateStr}', 'large')" ${!canOrderNormal ? 'style="opacity:0.5;cursor:not-allowed;"' : ''}>
              <div class="option-name">${menus[dateStr].normal}ï¼ˆå¤§ç››ã‚Šï¼‰</div>
              <div class="option-price">${getPriceDisplay('large', dateStr)}</div>
            </div>
            <div class="menu-option ${currentOrder === 'mannan' ? 'selected' : ''}" onclick="selectOption('${dateStr}', 'mannan')" ${!canOrderNormal ? 'style="opacity:0.5;cursor:not-allowed;"' : ''}>
              <div class="option-name">${menus[dateStr].normal}ï¼ˆãƒãƒ³ãƒŠãƒ³ï¼‰</div>
              <div class="option-price">${getPriceDisplay('mannan', dateStr)}</div>
            </div>
            <div class="menu-option ${currentOrder === 'noodle' ? 'selected' : ''}" onclick="selectOption('${dateStr}', 'noodle')" ${!canOrderNoodleMenu ? 'style="opacity:0.5;cursor:not-allowed;"' : ''}>
              <div class="option-name">${menus[dateStr].noodle}</div>
              <div class="option-price">${getPriceDisplay('noodle', dateStr)}</div>
            </div>
          </div>
        </div>
      `;
    }
  }
  orderContent.innerHTML = html;
}

function updateHistory() {
  const period = document.getElementById('historyPeriod').value;
  const historyContent = document.getElementById('historyContent');

  if (!orders[currentUser.id]) {
    historyContent.innerHTML = '<p>æ³¨æ–‡å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
    return;
  }

  const userOrders = orders[currentUser.id];
  const now = new Date();
  let totalCost = 0;
  let html = '<table><thead><tr><th>æ—¥ä»˜</th><th>ãƒ¡ãƒ‹ãƒ¥ãƒ¼</th><th>ã‚¿ã‚¤ãƒ—</th><th>è‡ªå·±è² æ‹…é¡</th></tr></thead><tbody>';

  Object.keys(userOrders).sort().forEach(dateStr => {
    const orderDate = new Date(dateStr);
    const option = userOrders[dateStr];

    if (shouldIncludeInPeriod(orderDate, period) && option !== 'none') {
      const cost = getSelfCost(option, dateStr);
      totalCost += cost;

      const optionNames = {
        'normal': 'é€šå¸¸', 'large': 'å¤§ç››ã‚Š', 'mannan': 'ãƒãƒ³ãƒŠãƒ³', 'noodle': 'éººé¡'
      };
      const menuName = option === 'noodle' ? (menus[dateStr]?.noodle || 'éººé¡') : (menus[dateStr]?.normal || 'é€šå¸¸å¼å½“');

      html += `
        <tr>
          <td>${dateStr}${isLunchDay(dateStr) ? ' ğŸ±' : ''}</td>
          <td>${menuName}</td>
          <td>${optionNames[option]}</td>
          <td>${cost}å††</td>
        </tr>
      `;
    }
  });

  html += '</tbody></table>';
  html += `<div class="order-summary"><div class="summary-total">åˆè¨ˆè‡ªå·±è² æ‹…é¡: ${totalCost}å††</div></div>`;
  historyContent.innerHTML = html;
}
</script>
